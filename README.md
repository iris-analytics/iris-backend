# iris-backend

Backend for iris-analytics.
This small app will store events generated by [iris-agent](https://github.com/iris-analytics/iris-agent) into [ClickHouse](https://clickhouse.yandex/).

There are tons of TODOs, in the meanwhile you can read Makefile.

The application stores data in [ClickHouse](https://clickhouse.yandex/) using a simple HTTP request.

- [iris-backend](#iris-backend)
  - [Run it](#run-it)
    - [From source](#from-source)
    - [From docker image](#from-docker-image)
    - [Required environment variables](#required-environment-variables)
  - [Test](#test)
  - [Extend it](#extend-it)

## Run it

### From source

You can execute `make run` to run the application. Make sure you create a `.env` file
(you can copy `.env.dist` and customize it according to your needs).

### From docker image

You can also run it using docker.
At the moment, we are currently offering only an image for `master` branch until it's stable and well documented.

```bash
docker pull irisanalytics/iris-backend:master
```

### Required environment variables

`iris-backend` relies on the following variables to run (if not found it will fatally exit)

- `IRIS_CLICKHOUSE_DSN`: Connection string to your `ClickHouse` instance. You can also point to [clickhouse-bulk](https://github.com/nikepan/clickhouse-bulk) or [chproxy](https://github.com/Vertamedia/chproxy).
- `IRIS_CLICKHOUSE_TABLE`: The table where data will be stored. You can have different strategies: saving to a common table, saving to a null table and create materialized views to filter entries, etc.
- `IRIS_LISTEN_BINDING`: The port the application will be listening to
- `IRIS_RECORDER_PATH`: The path [iris-agent](https://github.com/iris-analytics/iris-agent) will be pointing to. **IMPORTANT**: Avoid using words like `pixel.gif`, `pixel.gif`, `px.gif` or any other that modern ad-blockers might filter.

Example: check [.env.dist](.env.dist)

## Test

```bash
make test
```

## Extend it

@todo